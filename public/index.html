<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Tanks</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2188750956198037"
     crossorigin="anonymous"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <!-- <link rel="manifest" href="/site.webmanifest"> -->
</head>

<body>
    <style>
    :root{
        --bg:#111318;
        --panel:#161a22;
        --muted:#8b93a7;
        --text:#e9eefc;
        --accent:#6ea8ff;
        --accent-2:#78f5cf;
        --danger:#ff6b6b;
        --ring: 0 0 0 3px rgba(110,168,255,.25);
        --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
        margin:0;
        background:
        radial-gradient(1200px 800px at 20% -10%, #1c2333 0%, rgba(28,35,51,0) 60%),
        radial-gradient(1000px 700px at 120% 20%, #0e3b2f40 0%, rgba(14,59,47,0) 55%),
        var(--bg);
        color:var(--text);
        font:500 16px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
        overflow:hidden;
    }

    
    /* Panel */
    #lobby-controls{
        position:fixed; inset:auto 24px 24px auto; /* bottom-right by default */
        display:grid; gap:10px;
        width: min(520px, calc(100vw - 48px));
        background:linear-gradient(180deg, #141923, #10141b);
        border:1px solid #20273a;
        border-radius:var(--radius);
        box-shadow:0 10px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
        padding:16px;
        backdrop-filter:saturate(130%) blur(8px);
        z-index:10;
    }

    @media (max-width:900px){
        #lobby-controls{ inset: 24px 24px auto 24px; } /* top on mobile */
    }

    .row{ display:grid; grid-template-columns: 1fr auto; gap:10px; }
    .stack{ display:grid; gap:8px; }

    label{ font-size:12px; color:var(--muted); letter-spacing:.02em; }
    input[type="text"]{
        width:100%; padding:12px 14px; border-radius:12px; border:1px solid #29324a;
        background:#0d1117; color:var(--text);
        outline:none; transition:.15s border-color, .15s box-shadow, .15s background;
    }
    input::placeholder{ color:#657091; }

    input:focus{ border-color:#36507e; box-shadow:var(--ring); background:#0b0f14; }
    input[disabled]{ opacity:.6; cursor:not-allowed; }

    button{
        padding:12px 14px; border-radius:12px; border:1px solid #2a3752;
        background:linear-gradient(180deg, #1c2740, #162035);
        color:var(--text); font-weight:600; letter-spacing:.02em;
        cursor:pointer; transition: .15s transform, .15s filter, .15s background, .15s border-color;
    }
    button:hover{ filter:brightness(1.05); }
    button:active{ transform:translateY(1px); }
    button[disabled]{ opacity:.5; cursor:not-allowed; }

    .btn-accent{
        border-color:#345fb3;
        background:linear-gradient(180deg, #2a69d0, #214ea6);
    }

    .btn-ghost{
        background:#0d1117; border-color:#2b3142;
    }

    /* Lobby info row (appears after youâ€™re in a lobby) */
    #lobby-info{
        display:none; align-items:center; justify-content:space-between;
        gap:10px; padding:10px 12px; border-radius:12px;
        background:#0d1117; border:1px solid #2b3142;
    }
    #lobby-code-badge{
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
        font-size:14px; letter-spacing:.18em; padding:8px 10px; border-radius:10px;
        background:#121826; border:1px dashed #2b3550; color:#cfe0ff;
    }

    /* Tiny helper text */
    .hint{ font-size:12px; color:#7c86a3; }

    /* Toast */
    #toast{
        position: fixed; left:50%; bottom:40px; transform:translateX(-50%) translateY(20px);
        background:#0b0f14; color:#e6f0ff; border:1px solid #25314a;
        padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none;
        transition:.25s opacity, .25s transform;
        box-shadow:0 6px 24px rgba(0,0,0,.45);
        z-index:999;
    }
    #toast.show{ opacity:1; transform:translateX(-50%) translateY(0); }
    
    /* Style the default p5 canvas if present */
    #defaultCanvas0{
    border-radius: 18px;
    box-shadow:
        0 20px 120px rgba(0,0,0,.55),
        inset 0 0 0 1px rgba(255,255,255,.04);
    z-index:1; /* sits above background, under start-screen */
    }

    </style>

    <div id="lobby-controls" role="region" aria-label="Lobby controls">
    <!-- Name -->
    <div class="stack">
        <label for="player-name">Display name</label>
        <div class="row">
        <input id="player-name" type="text" placeholder="Name" maxlength="16" autocomplete="name" />
        <button id="set-name" class="btn-accent">Save</button>
        </div>
        <div class="row" style="grid-template-columns:auto auto 1fr; gap:8px">
        <button id="random-name" class="btn-ghost">ðŸŽ² Random</button>
        <button id="edit-name" class="btn-ghost" style="display:none">Edit</button>
        <span id="name-status" class="hint"></span>
        </div>
    </div>

    <!-- Lobby actions -->
    <div class="stack">
        <label for="join-lobby-code">Play with friends</label>
        <div class="row">
        <input id="join-lobby-code" type="text" placeholder="Enter lobby code" inputmode="latin" autocapitalize="characters" />
        <button id="join-lobby" class="btn-accent" disabled>Join</button>
        </div>
        <div class="row" style="grid-template-columns:auto 1fr">
        <button id="create-lobby">Create new lobby</button>
        <span class="hint">Press Enter to submit. Code is not case sensitive.</span>
        </div>
    </div>

    <!-- Current lobby -->
    <div id="lobby-info" aria-live="polite">
        <span class="hint">Lobby</span>
        <span id="lobby-code-badge">----</span>
        <button id="copy-code" class="btn-ghost">Copy</button>
    </div>
    </div>

    <div id="toast" role="status" aria-live="polite"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.2/p5.min.js"
        integrity="sha512-1YMgn4j8cIL91s14ByDGmHtBU6+F8bWOMcF47S0cRO3QNm8SKPNexy4s3OCim9fABUtO++nJMtcpWbINWjMSzQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script src="p5.js"></script> -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/constants.js"></script>
    <script src="/vision.js"></script>
    <script src="/drawDrop.js"></script>
    <!-- <div id="lobby-controls">
      <input id="player-name" type="text" placeholder="Player">
      <button id="set-name">Set Name</button>
      <button id="create-lobby">Create Lobby</button>
      <input id="join-lobby-code" type="text" placeholder="Enter Lobby Code">
      <button id="join-lobby">Join Lobby</button>
  </div> -->
  <div>
    <!-- <h2 id="lobby-info">Lobby: N/A</h2> -->
  </div>
    <script>
        // const socket = io.connect('localhost:3000');
        const socket = io.connect('https://multiplayer-tanks-3fa3c942a132.herokuapp.com/');

        const el = (id) => document.getElementById(id);
        const toast = (msg) => {
            const t = el('toast');
            t.textContent = msg;
            t.classList.add('show');
            clearTimeout(toast._timer);
            toast._timer = setTimeout(() => t.classList.remove('show'), 1600);
        };

        const NAME_KEY = 'tanks.displayName';

        const getSavedName = () => localStorage.getItem(NAME_KEY) || '';
        const emitNameIfAny = () => {
        const n = getSavedName();
        if (n) socket.emit('setName', n);
        };

        function normalizeCode(raw){
            return raw.trim().toUpperCase().replace(/[^A-Z0-9]/g,'').slice(0,8);
        }

        function setButtonsEnabled(hasName){
            el('create-lobby').disabled = !hasName;
            const joinFilled = normalizeCode(el('join-lobby-code').value).length >= 2;
            el('join-lobby').disabled = !(hasName && joinFilled);
        }

        // === Name flow ===
        function applySavedNameUI(name){
            el('player-name').value = name || '';
            const has = !!name;
            el('player-name').disabled = has;
            el('set-name').style.display = has ? 'none' : '';
            el('edit-name').style.display = has ? '' : 'none';
            el('random-name').disabled = has;
            el('name-status').textContent = has ? `Saved as â€œ${name}â€` : 'Pick a name to continue';
            setButtonsEnabled(has);
        }

        function randomName(){
            const adjectives = ['Crimson','Quantum','Nimble','Nebula','Turbo','Silent','Swift','Azure','Cobalt','Verdant','Solar','Feral'];
            const nouns = ['Tank','Raptor','Blitz','Comet','Golem','Falcon','Viper','Knight','Forge','Sprite','Nova','Spectre'];
            return adjectives[Math.floor(Math.random()*adjectives.length)]
                + nouns[Math.floor(Math.random()*nouns.length)]
                + Math.floor(Math.random()*90+10);
        }

        function saveName(name){
            name = (name||'').trim().slice(0,16);
            if(!name){ toast('Enter a name first'); return; }
            localStorage.setItem(NAME_KEY, name);
            socket.emit('setName', name); // you already emit this in your current inline script :contentReference[oaicite:2]{index=2}
            applySavedNameUI(name);
            el('random-name').disabled = true;
            toast('Name saved');
        }

        // === Lobby UI ===
        function showLobbyCode(code){
            if(!code) return;
            el('lobby-info').style.display = 'grid';
            el('lobby-code-badge').textContent = code;
        }

        // === Wire up events (inputs & buttons) ===
        // initial state
        applySavedNameUI(localStorage.getItem(NAME_KEY));

        el('set-name').addEventListener('click', () => saveName(el('player-name').value));
        el('random-name').addEventListener('click', () => {
            el('player-name').value = randomName();
            el('player-name').focus();
        });
        el('edit-name').addEventListener('click', () => {
            el('player-name').disabled = false;
            el('player-name').focus();
            el('set-name').style.display = '';
            el('edit-name').style.display = 'none';
            el('random-name').disabled = false;
            el('name-status').textContent = 'Editing nameâ€¦';
        });

        el('player-name').addEventListener('input', () => setButtonsEnabled(!!el('player-name').value.trim()));
        el('join-lobby-code').addEventListener('input', () => {
            const v = normalizeCode(el('join-lobby-code').value);
            if(el('join-lobby-code').value !== v) el('join-lobby-code').value = v;
            setButtonsEnabled(!!localStorage.getItem(NAME_KEY));
        });

        // Submit on Enter
        document.addEventListener('keydown', (e) => {
        if (e.key !== 'Enter') return;
        const hasNameSaved = !!getSavedName();
        const code = normalizeCode(el('join-lobby-code').value);

        if (document.activeElement === el('player-name')) {
            saveName(el('player-name').value);
        } else if ((hasNameSaved || el('player-name').value.trim()) && code.length >= 2) {
            if (!hasNameSaved) saveName(el('player-name').value);
            socket.emit('joinLobby', {code, name: getSavedName()});
        } else if (hasNameSaved || el('player-name').value.trim()) {
            if (!hasNameSaved) saveName(el('player-name').value);
            socket.emit('createLobby');
        } else {
            toast('Save a name first');
        }
        });

        el('create-lobby').addEventListener('click', () => {
            if (!getSavedName() && el('player-name').value.trim()) {
                saveName(el('player-name').value);
            }
            if(!localStorage.getItem(NAME_KEY)) return toast('Save a name first');
            socket.emit('createLobby', { name: getSavedName() });
        });

        el('join-lobby').addEventListener('click', () => {
            if (!getSavedName() && el('player-name').value.trim()) {
                saveName(el('player-name').value);
            }
            if(!localStorage.getItem(NAME_KEY)) return toast('Save a name first');
            const code = normalizeCode(el('join-lobby-code').value);
            console.log('joining lobby', code);
            if(!code) return toast('Enter a lobby code');
            socket.emit('joinLobby', { code, name: getSavedName() });
        });

        el('copy-code').addEventListener('click', async () => {
            const code = el('lobby-code-badge').textContent.trim();
            if(!code) return;
            try{
            await navigator.clipboard.writeText(code);
            toast('Copied lobby code');
            }catch(e){
            toast('Copy failed');
            }
        });

        // Prevent drag selection while clicking around (you already had this) :contentReference[oaicite:5]{index=5}
        document.addEventListener('selectstart', (e)=>e.preventDefault());

        socket.on('lobbyCreated', (data) => {
            showLobbyCode(data.lobbyCode);
            el('join-lobby-code').value = data.lobbyCode;
            setButtonsEnabled(true);
            emitNameIfAny();
            toast('Lobby created');
        });

        socket.on('lobbyJoined', (data) => {
            showLobbyCode(data.lobbyCode);
            setButtonsEnabled(true);
            emitNameIfAny();
            toast('Joined lobby');
        });

        socket.on('error', (err) => { toast(err?.message || 'Something went wrong'); });
        </script>
    <script src="/sketch.js" type="text/javascript"></script>
</body>

</html>